<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <style>
      #showdropdown {
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
    <link rel="stylesheet" href="styles.css" />
    <script type="module" src="script.js"></script>
  </head>
  <body>
    <div class="container">
      <ul class="list-group" id="usrid"></ul>
      <div class="form-group">
        <label for="country">Multi Select </label>
        <div class="border">
          <div class="d-flex flex-wrap" id="buttonBadge"></div>
          <input
            type="email"
            placeholder="Enter Your Country"
            value=""
            class="form-control border-0"
            id="countryID"
          />
        </div>
        <ul id="showdropdown" class="list-group d-none"></ul>
      </div>
    </div>
    <script>
      const countries = [
        {
          id: 'g5g3g5',
          country: 'United States',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: 'df456g',
          country: 'Canada',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: 'w23f8j',
          country: 'Australia',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: '5rtf65',
          country: 'Austria',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: 'f56g54',
          country: 'India',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: 'gf5676',
          country: 'Germany',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: 'urue7e',
          country: 'Holland',
          selected: false,
          alreadyAdded: false,
        },
        { id: 'bf45g', country: 'UK', selected: false, alreadyAdded: false },
        {
          id: 'f36gg',
          country: 'Sri Lanka',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: '4fre5',
          country: 'Norway',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: '9gf55',
          country: 'NewZeland',
          selected: false,
          alreadyAdded: false,
        },
        {
          id: '9gf55',
          country: 'Polland',
          selected: false,
          alreadyAdded: false,
        },
      ];
      let elementid = document.getElementById('showdropdown');
      let inputId = document.getElementById('countryID');
      let buttonBadge = document.getElementById('buttonBadge');
      countries.map((obj) => {
        let li = document.createElement('li');
        let value = document.createTextNode(obj.country);
        li.classList.add('list-group-item');
        li.appendChild(value);
        elementid.appendChild(li);
      });
      inputId.addEventListener('click', (e) => {
        elementid.classList.remove('d-none');
      });
      document.addEventListener('click', (e) => {
        if (
          e.target.id !== 'countryID' &&
          elementid.classList.contains('d-none') === false
        ) {
          elementid.classList.add('d-none');
        }
      });
      buttonBadge.addEventListener('click', (e) => {
        updateBadge(e.target.id);
      });
      elementid.addEventListener('click', (e) => {
        countries.forEach((obj) => {
          if (e.target.innerText === obj.country) {
            obj.selected = true;
          }
        });
        appendBadge();
      });
      const updateBadge = (id) => {
        countries.forEach((obj) => {
          if (obj.id === id) {
            console.log(obj.id === id);
            obj.selected = false;
            obj.alreadyAdded = false;
          }
        });
        document.getElementById('buttonBadge').innerHTML = '';
        countries.forEach((obj) => {
          if (obj.selected) {
            appendElement(obj);
          }
        });
        console.log(countries);
      };
      const appendElement = (obj) => {
        let a = document.createElement('a');
        let value = document.createTextNode(obj.country);
        a.classList.add('btn');
        a.classList.add('btn-primary');
        a.classList.add('mr-2');
        a.appendChild(value);
        buttonBadge.appendChild(a);
        a.insertAdjacentHTML(
          'beforeend',
          `<span id=${obj.id} class="ml-3">X</span>`
        );
      };
      const appendBadge = () => {
        countries.forEach((obj) => {
          if (obj.selected && obj.alreadyAdded === false) {
            obj.alreadyAdded = true;
            appendElement(obj);
          }
        });
      };
      window.addEventListener('load', (event) => {
        appendBadge();
      });
    </script>
  </body>
</html>
